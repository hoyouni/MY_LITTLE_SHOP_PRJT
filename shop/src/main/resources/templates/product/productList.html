<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <!-- ê²½ë¡œë¥¼ / ë¶€í„° ì‹œì‘í•˜ë©´ static í´ë” í•˜ìœ„ íŒŒì¼ë“¤ ì‚¬ìš© ê°€ëŠ¥-->
    <link href="/main.css" rel="stylesheet">
</head>
<body>

<!--ìƒë‹¨ navbar -->
<div th:replace="~{nav.html::navbar}"></div>

<!-- ë³µìˆ˜ ê±´ì„ ì¶œë ¥í•˜ê³  ì‹¶ì„ ë•ŒëŠ” í•´ë‹¹ ì½”ë“œì™€ ê°™ì´ thymeleaf ì˜ each ì½”ë“œë¥¼ ì‚¬ìš©í•´ì„œ ë½‘ì•„ë‚´ë©´ ë°˜ë³µë¬¸ ëŒë©´ì„œ ì¶œë ¥í•¨ -->
<div class="card" th:each="prdList : ${products}">
    <img src="https://placehold.co/300">
    <div>
        <h4 th:text="${prdList.prodCd}"></h4>
        <a th:href="@{'/product/' + ${prdList.prodCd} }">
            <h4 th:text="${prdList.prodNm}"></h4>
        </a>
        <p th:text="${prdList.price + 'ì›'}"><p>
        <a th:href="@{'/product/productEdit/' + ${prdList.prodCd} }">
            <h4>âœï¸</h4>
        </a>
        <!-- ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ajax ì²˜ë¦¬í•  ë•Œ -->
        <span sec:authorize="hasAuthority('admin')" th:onclick="fetch('/product/deletePrdToQueryStr?prodCd=[[${prdList.prodCd}]]', { method : 'DELETE' } )
          .then(r => r.text())
          .then(result => {
                if(result == 'DELETE') {
                    location.reload();
                }
           })
        ">ğŸ—‘ï¸(ê´€ë¦¬ììš©)
        </span>
        <!-- post ë°©ì‹ìœ¼ë¡œ ajax í˜¸ì¶œí•  ë•Œ -->
        <button class="deleteBtn">ğŸ—‘</button>
    </div>
</div>

<!-- í˜ì´ì§€ ë²ˆí˜¸ ë§í¬ ì¶œë ¥ -->
<!-- í˜ì´ì§€ ë²ˆí˜¸ ì»¨í…Œì´ë„ˆ -->
<div class="pagination-container">
    <a th:each="pageNum : ${pages}"
       th:href="@{'/product/productList/page/' + ${pageNum + 1}}"
       th:text="${pageNum + 1}">
    </a>
</div>


<!-- ì°¸ê³ ë¡œ ë‹¨ì¼ ê±´ì¸ ê²½ìš° ì´ë ‡ê²Œ ì‚¬ìš©í•˜ê³ 
    <div class="card">
        <img src="https://placehold.co/300">
        <div>
            ì°¸ê³ ë¡œ ${products[0].prodCd} ë¡œ ì‚¬ìš©í•´ë„ ë¬´ë°©í•¨
            <h4 th:text="${products.prodCd}"></h4>
            <h4 th:text="${products.prodNm}"></h4>
            <p th:text="${products.price}"><p>
        </div>
    </div>
-->

</body>

<script>
    // post ìš”ì²­ìœ¼ë¡œ íŠ¹ì • ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ajax ìš”ì²­í•  ë•Œ ì²˜ë¦¬
    document.querySelectorAll('.deleteBtn').forEach(function(button){
        button.addEventListener('click', function(){

            if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){

                const parentDiv = button.closest('div'); // ìƒìœ„ div ì°¾ê¸°
                const prodCd = parentDiv.querySelector('h4').textContent; // ì²« ë²ˆì§¸ h4ê°€ prodCd

                fetch('/product/deletePrdToAjax', {
                    method : 'POST',
                    headers : {
                      "Content-Type": "application/json",
                    },
                    body : JSON.stringify({prodCd: prodCd.trim()})
                })
                .then(response => response.json())
                .then(result => {
                    if (result.result === 'success') {
                        alert('ì‚­ì œ ì™„ë£Œ!');
                        location.reload();
                    } else {
                        alert('ì‚­ì œ ì‹¤íŒ¨!');
                    }
                })
                .catch(error => {
                    console.error('ì—ëŸ¬ ë°œìƒ:', error);
                });
            }
            else {
                return;
            }
        });
    });
</script>

<!-- í˜ì´ì§• ìŠ¤íƒ€ì¼ -->
<style>
    .pagination-container {
        display: flex;
        justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
        gap: 10px; /* í˜ì´ì§€ ë²ˆí˜¸ ì‚¬ì´ ê°„ê²© */
        margin-top: 30px;
    }

    .pagination-container a {
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        text-decoration: none;
        color: black;
    }

    .pagination-container a:hover {
        background-color: #f0f0f0;
    }
</style>

</html>